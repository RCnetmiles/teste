<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Labeler: Protocolo GHS</title>
    <style>
        :root {
            --paper-bg: #d2b48c;
            --lab-bg: #2c3e50;
            --ui-panel: #34495e;
            --accent: #e67e22;
            --text: #ecf0f1;
        }

        body, html {
            margin: 0; padding: 0;
            height: 100%; font-family: 'Courier New', Courier, monospace;
            background: var(--lab-bg); color: var(--text);
            overflow: hidden;
        }

        /* Layout Principal */
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Parte Superior: O Frasco */
        #visual-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: radial-gradient(circle, #34495e 0%, #1a252f 100%);
            border-bottom: 4px solid #000;
        }

        .bottle {
            width: 120px;
            height: 180px;
            border: 3px solid #eee;
            border-radius: 10px 10px 5px 5px;
            position: relative;
            transition: all 0.3s;
        }
        .glass { background: rgba(200, 230, 255, 0.3); border-color: #add8e6; }
        .plastic { background: #fdfdfd; border-color: #ccc; }

        .label-preview {
            width: 80%;
            height: 60%;
            background: white;
            margin: 30% auto 0;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 2px;
        }

        .pictogram-mini {
            width: 25px;
            height: 25px;
            border: 1px solid red;
        }

        /* Parte Inferior: Comandos */
        #ui-area {
            flex: 1;
            background: var(--ui-panel);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.5);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        button {
            background: #95a5a6;
            border: none;
            padding: 10px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            border-bottom: 4px solid #7f8c8d;
        }
        button:active { border-bottom: 0; transform: translateY(2px); }
        button.active { background: var(--accent); color: white; border-color: #d35400; }

        /* Pictogramas GHS */
        .pictogram-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            background: #bdc3c7;
            padding: 5px;
            border-radius: 5px;
        }
        .pic-btn {
            width: 100%;
            aspect-ratio: 1;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: 1px solid #777;
            background-color: white;
        }

        /* Modal do Formul√°rio */
        #document-overlay {
            position: absolute;
            top: 10%; left: 5%; width: 90%; height: 80%;
            background: var(--paper-bg);
            color: #333;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.8);
            display: none;
            z-index: 100;
            border: 1px solid #8b4513;
        }

        .score-screen {
            position: fixed; top: 0; left:0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="visual-area">
        <div id="main-bottle" class="bottle plastic">
            <div class="label-preview" id="label-view"></div>
        </div>
        <div id="product-tag" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px;">
            Amostra #<span id="current-index">1</span>
        </div>
    </div>

    <div id="ui-area">
        <div class="controls-grid">
            <button onclick="toggleDoc()">üìÑ Ver Ficha</button>
            <button id="btn-glass" onclick="setMaterial('glass')">Vidro</button>
            <button id="btn-plastic" onclick="setMaterial('plastic')" class="active">Pl√°stico</button>
        </div>

        <div class="pictogram-selector" id="pic-grid">
            <button class="pic-btn" onclick="togglePic('üî•')" title="Inflam√°vel">üî•</button>
            <button class="pic-btn" onclick="togglePic('üíÄ')" title="T√≥xico">üíÄ</button>
            <button class="pic-btn" onclick="togglePic('üß™')" title="Corrosivo">üß™</button>
            <button class="pic-btn" onclick="togglePic('üí•')" title="Explosivo">üí•</button>
            <button class="pic-btn" onclick="togglePic('‚ö†Ô∏è')" title="Irritante">‚ö†Ô∏è</button>
            <button class="pic-btn" onclick="togglePic('‚≠ï')" title="Oxidante">‚≠ï</button>
            <button class="pic-btn" onclick="togglePic('üë§')" title="Sa√∫de">üë§</button>
            <button class="pic-btn" onclick="togglePic('üêü')" title="Ambiente">üêü</button>
            <button class="pic-btn" onclick="togglePic('‚òÅÔ∏è')" title="G√°s sob press√£o">‚òÅÔ∏è</button>
        </div>

        <button style="background: #27ae60; border-color: #2ecc71; color: white; margin-top: auto; padding: 20px;" onclick="storeProduct()">
            üì• ARMAZENAR (PR√ìXIMO)
        </button>
    </div>
</div>

<div id="document-overlay" onclick="toggleDoc()">
    <h2 style="text-align: center; border-bottom: 2px solid #000;">FICHA DE PRODUTO</h2>
    <p><strong>Nome:</strong> <span id="doc-name">---</span></p>
    <p><strong>Descri√ß√£o:</strong> <span id="doc-desc">---</span></p>
    <p><strong>Propriedades:</strong> <span id="doc-prop">---</span></p>
    <p style="margin-top: 50px; font-style: italic; font-size: 0.8em; color: #555;">Toque em qualquer lugar para fechar.</p>
</div>

<div class="score-screen" id="finish-screen">
    <h1>RELAT√ìRIO FINAL</h1>
    <p style="font-size: 2em;">Pontua√ß√£o: <span id="final-score">0</span>%</p>
    <button onclick="location.reload()" style="background: var(--accent);">Reiniciar Turno</button>
</div>

<script>
    // Banco de dados dos produtos (Exemplos GHS/ABNT 14725)
    const products = [
        {
            name: "√Ålcool Et√≠lico 70%",
            desc: "L√≠quido incolor, odor caracter√≠stico.",
            prop: "Altamente inflam√°vel. Causa irrita√ß√£o ocular grave.",
            correctMaterial: "plastic",
            correctPics: ["üî•", "‚ö†Ô∏è"]
        },
        {
            name: "√Åcido Sulf√∫rico Concentrado",
            desc: "L√≠quido viscoso, altamente reativo.",
            prop: "Corrosivo para metais. Provoca queimaduras graves na pele.",
            correctMaterial: "glass",
            correctPics: ["üß™"]
        },
        {
            name: "Hipoclorito de S√≥dio",
            desc: "Solu√ß√£o para limpeza e desinfec√ß√£o.",
            prop: "Muito t√≥xico para a vida aqu√°tica. Corrosivo.",
            correctMaterial: "plastic",
            correctPics: ["üß™", "üêü"]
        },
        {
            name: "Nitrog√™nio L√≠quido",
            desc: "G√°s liquefeito refrigerado.",
            prop: "Cont√©m g√°s sob press√£o. Pode causar queimaduras criog√™nicas.",
            correctMaterial: "glass",
            correctPics: ["‚òÅÔ∏è"]
        },
        {
            name: "Benzeno",
            desc: "Solvente org√¢nico industrial.",
            prop: "Pode causar c√¢ncer. L√≠quido e vapores inflam√°veis. T√≥xico.",
            correctMaterial: "glass",
            correctPics: ["üî•", "üíÄ", "üë§"]
        }
    ];

    let currentIndex = 0;
    let score = 0;
    let userPics = [];
    let userMaterial = "plastic";

    function updateDisplay() {
        if (currentIndex >= products.length) {
            showFinalScore();
            return;
        }
        
        const p = products[currentIndex];
        document.getElementById('current-index').innerText = currentIndex + 1;
        document.getElementById('doc-name').innerText = p.name;
        document.getElementById('doc-desc').innerText = p.desc;
        document.getElementById('doc-prop').innerText = p.prop;
        
        // Reset label
        userPics = [];
        renderLabel();
    }

    function toggleDoc() {
        const doc = document.getElementById('document-overlay');
        doc.style.display = (doc.style.display === 'block') ? 'none' : 'block';
    }

    function setMaterial(type) {
        userMaterial = type;
        const bottle = document.getElementById('main-bottle');
        bottle.className = 'bottle ' + type;
        
        document.getElementById('btn-glass').classList.toggle('active', type === 'glass');
        document.getElementById('btn-plastic').classList.toggle('active', type === 'plastic');
    }

    function togglePic(emoji) {
        const index = userPics.indexOf(emoji);
        if (index > -1) {
            userPics.splice(index, 1);
        } else {
            if (userPics.length < 4) userPics.push(emoji);
        }
        renderLabel();
    }

    function renderLabel() {
        const view = document.getElementById('label-view');
        view.innerHTML = '';
        userPics.forEach(p => {
            const div = document.createElement('div');
            div.className = 'pictogram-mini';
            div.innerText = p;
            div.style.display = 'flex';
            div.style.justifyContent = 'center';
            div.style.alignItems = 'center';
            view.appendChild(div);
        });
    }

    function storeProduct() {
        const p = products[currentIndex];
        
        // L√≥gica de Pontua√ß√£o: 
        // 50% pelo material, 50% pelos pictogramas corretos
        let roundScore = 0;
        
        if (userMaterial === p.correctMaterial) roundScore += 50;
        
        const correctCount = p.correctPics.filter(x => userPics.includes(x)).length;
        const wrongCount = userPics.filter(x => !p.correctPics.includes(x)).length;
        
        let picScore = (correctCount / p.correctPics.length) * 50;
        picScore -= (wrongCount * 10); // Penalidade por erro
        
        score += Math.max(0, roundScore + picScore);
        
        currentIndex++;
        updateDisplay();
    }

    function showFinalScore() {
        const final = (score / (products.length * 100)) * 100;
        document.getElementById('finish-screen').style.display = 'flex';
        document.getElementById('final-score').innerText = Math.round(final);
    }

    // Inicializar
    updateDisplay();
</script>

</body>
</html>
