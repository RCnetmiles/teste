 <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de POPs - Citometria</title>
    <!-- Tailwind CSS para estilização rápida e responsiva -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <!-- html2pdf para gerar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Estilos globais */
        body {
            overscroll-behavior-y: none; /* Previne efeito elástico indesejado no mobile */
        }

        /* Checkbox customizado para ficar visível e bonito */
        input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.25rem;
            border: 2px solid #d1d5db;
            color: #2563eb;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            display: inline-block;
            position: relative;
            vertical-align: middle;
            background-color: white;
        }
        
        input[type="checkbox"]:checked {
            background-color: #2563eb;
            border-color: #2563eb;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }

        /* Estilo para simular folha A4 na tela (Desktop) */
        .a4-paper {
            max-width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            margin: 0 auto;
            padding: 20mm;
        }

        /* Estilos de Impressão */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; height: auto; overflow: visible; }
            .a4-paper { box-shadow: none; margin: 0; padding: 0; width: 100%; max-width: none; }
            .page-break { page-break-before: always; }
        }
        
        /* Estilo específico para o PDF */
        .pdf-content {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.5;
            color: #000;
        }
        
        .pdf-content h1 {
            color: #1e3a8a;
            border-bottom: 2px solid #1e3a8a;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 24pt;
        }
        
        .pdf-content h3 {
            color: #1e3a8a;
            background-color: #f0f9ff;
            padding: 0.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #1e40af;
            font-size: 14pt;
            font-weight: bold;
        }
        
        .pdf-content h4 {
            color: #374151;
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
            font-size: 12pt;
            font-weight: bold;
        }
        
        .pdf-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .pdf-content ul, .pdf-content ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }
        
        .pdf-content li {
            margin-bottom: 0.5rem;
        }
        
        .pdf-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .pdf-content th, .pdf-content td {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            font-size: 10pt;
            vertical-align: top;
        }
        
        .pdf-content th {
            background-color: #f3f4f6;
            font-weight: bold;
        }
        
        .pdf-content hr {
            border: 0;
            border-top: 2px solid #e5e7eb;
            margin: 1.5rem 0;
        }
        
        .pdf-content strong {
            font-weight: bold;
        }
        
        .pdf-content em {
            font-style: italic;
        }
        
        .pdf-checkbox {
            font-size: 14pt;
            margin-right: 0.5rem;
        }
        
        .pdf-header {
            border-bottom: 2px solid #000;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        
        .pdf-footer {
            margin-top: 4rem;
            padding-top: 1rem;
            border-top: 1px solid #d1d5db;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 h-screen overflow-hidden flex flex-col">

    <!-- Lógica da Aplicação -->
    <script>
        // Ícones SVG
        const ICONS = {
            droplets: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>`,
            activity: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`,
            thermometer: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></svg>`,
            testTube: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2"/><path d="M8.5 2h7"/><path d="M14.5 16h-6"/></svg>`,
            chevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>`,
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
            download: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>`,
            printer: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>`,
            pdf: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2"/><path d="M4 7h16"/><path d="M4 7v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7"/><rect width="8" height="5" x="8" y="12" rx="1"/><path d="M10 12v-2a2 2 0 1 1 4 0v2"/></svg>`
        };

        // Dados dos Protocolos
        const POP_DATA = [
            {
                id: 'pop01',
                code: 'POP 01',
                title: 'Manutenção Diária (Limpezas e QC)',
                icon: ICONS.droplets,
                colorClass: 'bg-green-100 text-green-700',
                content: `
                    <h1>POP 01: MANUTENÇÃO DIÁRIA</h1>
                    <p><strong>Frequência:</strong> Todos os dias de uso.</p>
                    <p><strong>Resumo do Fluxo:</strong> Limpeza Inicial &rarr; PQC & ATSS &rarr; Rotina &rarr; Limpeza Final.</p>

                    <h3>1. MATERIAIS NECESSÁRIOS</h3>
                    <ul>
                        <li><strong>BD CS&T Beads</strong> (4 gotas + 1 mL Flow Filtrado).</li>
                        <li><strong>Soluções de Limpeza:</strong> BD FACSClean (Hipoclorito), BD Detergent Solution, Água DI.</li>
                        <li>Tubos 12x75mm.</li>
                    </ul>

                    <hr>

                    <h3>PARTE A: INÍCIO DO TURNO (LIMPEZA INICIAL)</h3>
                    <p><em>Objetivo: Condicionar o sistema fluídico e remover bolhas antes da calibração.</em></p>
                    
                    <h4>A.1. Verificações</h4>
                    <ul>
                        <li>Verificar nível do tanque <strong>Sheath</strong> (Encher se necessário) e <strong>Waste</strong> (Esvaziar e adicionar hipoclorito).</li>
                        <li>Verificar LEDs de status: <strong>Âmbar piscante</strong> indica aquecimento dos lasers (20 min) ou fluido baixo.</li>
                    </ul>

                    <h4>A.2. Sequência de Condicionamento (Tube Settings: Flow Rate High)</h4>
                    <ol>
                        <li><strong>Detergent Solution:</strong> Adquirir por <strong>1 minuto</strong>.</li>
                        <li>Executar comando: <strong>3x Clean Cuvette</strong> (com Detergente).</li>
                        <li><strong>Repouso:</strong> Deixar agir por <strong>10 a 15 minutos</strong> (Sem aquisição).</li>
                        <li><strong>Água DI:</strong> Adquirir por <strong>1 minuto</strong>.</li>
                        <li>Executar comando: <strong>3x Clean Cuvette</strong> (com Água).</li>
                        <li>Executar comando: <strong>3x Purge Sheath Filter</strong> (Remove ar do filtro).</li>
                        <li>Executar comando: <strong>3x Drain and Fill Flow Cell</strong>.</li>
                        <li><strong>Estabilização:</strong> Adquirir Água por <strong>10 minutos</strong>.
                            <br><em>Critério: Variação da taxa (Threshold Rate) < 10 evts/s nos últimos 2 min.</em></li>
                    </ol>

                    <hr>

                    <h3>PARTE B: CALIBRAÇÃO (PQC E ATSS)</h3>
                    
                    <h4>B.1. Performance QC (PQC)</h4>
                    <ol>
                        <li>Preparar tubo com <strong>1 mL Flow Filtrado + 4 gotas CS&T</strong>. Vortexar.</li>
                        <li>No software: <em>Setup & QC > Performance QC</em>. Conferir Lote.</li>
                        <li>Rodar. Verificar se resultado é <strong>PASS</strong>.</li>
                        <li>Checar Relatório: <strong>Delta PMT</strong> (-50 a +50) e <strong>%rCV</strong> (0 a 6 nos canais principais).</li>
                    </ol>

                    <h4>B.2. Assay Tube Settings Setup (ATSS)</h4>
                    <ol>
                        <li>Imediatamente após o PQC, selecionar <em>Assay/Tube Settings Setup</em>.</li>
                        <li>Usar o mesmo tubo de CS&T. Rodar para atualizar as voltagens dos ensaios (OneFlow).</li>
                    </ol>

                    <hr>

                    <h3>PARTE C: FINAL DO TURNO (LIMPEZA FINAL)</h3>
                    <p><strong style="color: #dc2626;">PERIGO:</strong> NUNCA misture FACSClean (Hipoclorito) direto com Detergente. Use Água entre eles.</p>
                    
                    <h4>C.1. Sequência de Lavagem (Modo Manual - High)</h4>
                    <ol>
                        <li><strong>PASSO 1: BD FACSClean</strong> - Adquirir 5 minutos.</li>
                        <li><strong>PASSO 2: ÁGUA</strong> - Adquirir 1 minuto (Obrigatório para enxágue).</li>
                        <li><strong>PASSO 3: BD DETERGENT SOLUTION</strong> - Adquirir 5 minutos.</li>
                        <li><strong>PASSO 4: ÁGUA</strong> - Adquirir 5 minutos.</li>
                    </ol>

                    <h4>C.2. Desligamento</h4>
                    <ol>
                        <li>Deixar tubo com <strong>2 mL de Água DI</strong> na probe.</li>
                        <li>Executar <em>Cytometer > Shutdown</em>.</li>
                    </ol>

                    <!-- CHECKLIST -->
                    <div style="page-break-before: always; margin-top: 30px; padding: 15px; border: 1px solid #ccc;">
                        <h4 style="text-align: center;">CHECKLIST DIÁRIO</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; width: 40px;">□</td>
                                <td>Limpeza Inicial (Detergente > Repouso > Água)</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px;">□</td>
                                <td>Purge e Drain/Fill realizados</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px;">□</td>
                                <td>Estabilização com Água ok</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px;">□</td>
                                <td>PQC Aprovado</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px;">□</td>
                                <td>ATSS Atualizado</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px;">□</td>
                                <td>Limpeza Final (Clean > Água > Detergente > Água)</td>
                            </tr>
                        </table>
                    </div>
                `
            },
            {
                id: 'pop02',
                code: 'POP 02',
                title: 'Manutenção Bimestral (60 Dias)',
                icon: ICONS.droplets,
                colorClass: 'bg-blue-100 text-blue-700',
                content: `
                    <h1>POP 02: MANUTENÇÃO DE 60 DIAS</h1>
                    <p><strong>Frequência:</strong> A cada 2 meses.</p>
                    <p><strong>Resumo do Fluxo:</strong> Limpeza Inicial &rarr; PQC &rarr; URS &rarr; ATSS &rarr; Limpeza Mensal.</p>

                    <h3>1. LIMPEZA INICIAL E PQC</h3>
                    <p>Realizar todo o procedimento descrito na <strong>Parte A e B.1 do POP 01</strong> (Limpeza de condicionamento e PQC com CS&T).</p>

                    <h3>2. UPDATE REFERENCE SETTINGS (URS)</h3>
                    <p><em>Atualização da matriz de compensação espectral e brilho dos fluorocromos.</em></p>
                    
                    <h4>2.1. Preparo das FC Beads</h4>
                    <ul>
                        <li>Aclimatar sachês por 15 min.</li>
                        <li>Em tubos separados: <strong>1 gota de FC Bead</strong> + <strong>10 gotas de Diluente</strong> (ou 500 µL).</li>
                        <li>Vortexar vigorosamente.</li>
                    </ul>

                    <h4>2.2. Execução no Software</h4>
                    <ol>
                        <li>Ir em <em>Setup & QC > Update Reference Settings</em>.</li>
                        <li>Selecionar a configuração: <strong>Lyse/Wash</strong>.</li>
                        <li>Se houver lote novo de FC Beads, importar o arquivo na Library antes.</li>
                        <li>Seguir o assistente e adquirir cada tubo de cor solicitado.</li>
                        <li>Verificar gráficos: P1 (Beads), P2 (Positivo), P3 (Negativo). Aceitar se "Pass".</li>
                    </ol>

                    <h3>3. ATSS (Assay Tube Settings Setup)</h3>
                    <p>Após atualizar as referências (URS), rodar novamente o ATSS com as CS&T Beads para recalcular as voltagens dos ensaios com a nova compensação.</p>

                    <h3>4. LIMPEZA MENSAL (MONTHLY CLEAN)</h3>
                    <p><em>Procedimento físico de limpeza das linhas.</em></p>
                    <p><strong style="color: #dc2626;">CRÍTICO:</strong> Realizar o <strong>BYPASS</strong> do Filtro de Sheath. O filtro de papel é destruído pelo FACSClean.</p>
                    
                    <ol>
                        <li>Esvaziar Waste.</li>
                        <li><strong>Bypass:</strong> Desconectar o filtro lateral e unir as mangueiras com o conector de união.</li>
                        <li>Trocar o tanque de Sheath por um tanque com <strong>2 Litros de BD FACSClean</strong>.</li>
                        <li>No software: <em>Cytometer > Fluidics > Monthly Clean</em>. Seguir o wizard (aprox. 30 min).</li>
                        <li><strong>Enxágue:</strong> Trocar o tanque de FACSClean pelo tanque de Sheath (Salina) original quando solicitado.</li>
                        <li>Ao finalizar, <strong>reconectar o Filtro</strong> (atenção à seta de fluxo).</li>
                        <li>Executar <strong>3x Purge Sheath Filter</strong> para tirar bolhas do filtro.</li>
                    </ol>

                    <!-- CHECKLIST -->
                    <div style="page-break-before: always; margin-top: 30px; padding: 15px; border: 1px solid #ccc;">
                        <h4 style="text-align: center;">CHECKLIST 60 DIAS</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr><td style="padding: 5px; width: 40px;">□</td><td>Limpeza Inicial e PQC realizados</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Update Reference Settings (FC Beads) Aprovado</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>ATSS Atualizado pós-URS</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Bypass do filtro realizado antes do Monthly Clean</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Monthly Clean finalizado e Enxágue feito</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Filtro reconectado e Purgado</td></tr>
                        </table>
                    </div>
                `
            },
            {
                id: 'pop03',
                code: 'POP 03',
                title: 'Manutenção Semestral',
                icon: ICONS.droplets,
                colorClass: 'bg-purple-100 text-purple-700',
                content: `
                    <h1>POP 03: MANUTENÇÃO SEMESTRAL</h1>
                    <p><strong>Frequência:</strong> A cada 6 meses (ou troca de lote de CS&T sem transferência).</p>
                    <p><strong>Resumo do Fluxo:</strong> Limpeza Inicial &rarr; CQC &rarr; PQC &rarr; URS &rarr; ATSS &rarr; Limpeza Final.</p>

                    <h3>1. LIMPEZA INICIAL</h3>
                    <p>Executar rigorosamente a limpeza de condicionamento (Detergente/Repouso/Água/Purge/Drain) conforme <strong>POP 01</strong>.</p>

                    <h3>2. CHARACTERIZATION QC (CQC)</h3>
                    <p><em>Define a linha de base do equipamento (Voltagens iniciais, Linearidade, Resolução). Exige nível de acesso Administrador.</em></p>
                    
                    <ol>
                        <li>Preparar CS&T novo: 4 gotas + 1 mL Flow Filtrado.</li>
                        <li>Ir em <em>Setup & QC > Characterization QC</em>.</li>
                        <li>Desabilitar "High Sensitivity" se não for utilizado.</li>
                        <li>Rodar o tubo. O sistema ajustará os ganhos ótimos.</li>
                    </ol>

                    <h3>3. SEQUÊNCIA DE AJUSTES PÓS-CQC</h3>
                    <p>Após definir a nova baseline (CQC), é obrigatório atualizar toda a cadeia de configurações:</p>
                    <ol>
                        <li><strong>Performance QC (PQC):</strong> Para confirmar que a nova baseline está estável.</li>
                        <li><strong>Update Reference Settings (URS):</strong> Com FC Beads, para recalcular a matriz de compensação na nova voltagem.</li>
                        <li><strong>Assay Tube Settings Setup (ATSS):</strong> Com CS&T, para linkar os ensaios à nova configuração.</li>
                    </ol>

                    <h3>4. LIMPEZA FINAL</h3>
                    <p>Executar a limpeza final padrão (Clean > Água > Detergente > Água) e desligar.</p>

                    <!-- CHECKLIST -->
                    <div style="page-break-before: always; margin-top: 30px; padding: 15px; border: 1px solid #ccc;">
                        <h4 style="text-align: center;">CHECKLIST SEMESTRAL</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr><td style="padding: 5px; width: 40px;">□</td><td>Limpeza Inicial Completa</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>CQC (Characterization) Aprovado</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>PQC Aprovado</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Reference Settings (URS) Atualizadas</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>ATSS Atualizado</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Limpeza Final Realizada</td></tr>
                        </table>
                    </div>
                `
            },
            {
                id: 'pop04',
                code: 'POP 04',
                title: 'Aquisição de Amostras (OneFlow)',
                icon: ICONS.testTube,
                colorClass: 'bg-orange-100 text-orange-700',
                content: `
                    <h1>POP 04: AQUISIÇÃO DE AMOSTRAS - ONEFLOW™</h1>
                    <p><strong>Aplicação:</strong> Imunofenotipagem Linfóide (LST).</p>

                    <h3>1. PRECAUÇÕES NA AQUISIÇÃO</h3>
                    <ul>
                        <li><strong style="color: #dc2626;">LIMITE DE TAXA:</strong> Ajustar o fluxo para não exceder <strong>30.000 eventos/segundo</strong>. Taxas maiores causam perda de dados (Abort Rate) e entupimento.</li>
                        <li><strong style="color: #dc2626;">VOLUME MÍNIMO:</strong> Se após as lavagens o volume de amostra for baixo, completar com PBS até atingir 100 µL <em>antes</em> de adicionar ao tubo de marcação seco.</li>
                    </ul>

                    <h3>2. PROCEDIMENTO DE PREPARO</h3>
                    
                    <h4>2.1. Lavagem (Remoção de Interferentes)</h4>
                    <ol>
                        <li>Em tubo cônico 15 mL: <strong>300 µL amostra</strong> + <strong>10 mL Wash Buffer</strong>.</li>
                        <li>Centrifugar: <strong>540g por 5 min</strong>. Descartar sobrenadante.</li>
                        <li>Repetir mais 2 vezes (Total de 3 lavagens).</li>
                        <li>Ajustar volume final do pellet (aprox. 200 µL).</li>
                    </ol>

                    <h4>2.2. Marcação e Lise</h4>
                    <ol>
                        <li>Adicionar <strong>100 µL da amostra lavada</strong> no tubo OneFlow LST (contendo reagente seco).</li>
                        <li>Vortexar. Incubar <strong>30 min</strong> (escuro).</li>
                        <li>Adicionar <strong>2 mL Lysing Solution (1X)</strong>.</li>
                        <li>Vortexar. Incubar <strong>10-12 min</strong> (escuro).</li>
                        <li>Centrifugar (540g/5min), descartar, lavar com 2 mL de Buffer.</li>
                        <li>Ressuspender em <strong>200 µL</strong> para leitura.</li>
                    </ol>

                    <h3>3. AQUISIÇÃO NO SOFTWARE</h3>
                    <ol>
                        <li>Na Worklist, selecionar a tarefa (Task) <strong>OneFlow LST</strong>.</li>
                        <li>Inserir ID da amostra.</li>
                        <li>Vortexar o tubo imediatamente antes de colocar na probe.</li>
                        <li>Clicar em <strong>Run</strong>. Monitorar a taxa de eventos.</li>
                        <li>Critério de parada padrão: 100.000 eventos totais.</li>
                    </ol>

                    <!-- CHECKLIST -->
                    <div style="page-break-before: always; margin-top: 30px; padding: 15px; border: 1px solid #ccc;">
                        <h4 style="text-align: center;">CHECKLIST AQUISIÇÃO</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr><td style="padding: 5px; width: 40px;">□</td><td>3 Lavagens prévias realizadas</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Incubação de marcação (30min)</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Lise (10-12min) e Lavagem final</td></tr>
                            <tr><td style="padding: 5px;">□</td><td>Taxa de eventos monitorada (<30.000)</td></tr>
                        </table>
                    </div>
                `
            }
        ];

        // --- ESTADO DA APLICAÇÃO ---
        let state = {
            selectedPopId: null,
            isMobile: window.innerWidth < 1024
        };

        const root = document.body;

        // --- FUNÇÕES PRINCIPAIS ---

        function init() {
            window.addEventListener('resize', handleResize);
            if (!state.isMobile) {
                state.selectedPopId = POP_DATA[0].id;
            }
            render();
        }

        function handleResize() {
            const mobile = window.innerWidth < 1024;
            if (mobile !== state.isMobile) {
                state.isMobile = mobile;
                render();
            }
        }

        function selectPop(id) {
            state.selectedPopId = id;
            render();
        }

        function goBack() {
            state.selectedPopId = null;
            render();
        }

        function render() {
            root.innerHTML = '';
            if (state.isMobile) {
                if (state.selectedPopId) {
                    renderMobileDetail();
                } else {
                    renderMobileList();
                }
            } else {
                renderDesktop();
            }
        }

        // --- RENDERIZADORES ---

        function renderMobileList() {
            const container = document.createElement('div');
            container.className = 'h-full bg-gray-50 pb-8 overflow-y-auto w-full';

            const header = document.createElement('div');
            header.className = 'bg-blue-900 text-white p-6 shadow-md rounded-b-2xl mb-6 sticky top-0 z-10';
            header.innerHTML = `
                <h1 class="text-2xl font-bold">Protocolos</h1>
                <p class="text-blue-200 text-sm">Laboratório de Citometria</p>
            `;
            container.appendChild(header);

            const listContainer = document.createElement('div');
            listContainer.className = 'px-4 space-y-4 pb-12';

            POP_DATA.forEach(pop => {
                const btn = document.createElement('button');
                btn.className = 'w-full bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between active:scale-95 transition-transform';
                btn.onclick = () => selectPop(pop.id);
                btn.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="p-3 rounded-full ${pop.colorClass}">
                            ${pop.icon}
                        </div>
                        <div class="text-left">
                            <span class="block text-xs font-bold text-gray-400 uppercase tracking-wider">${pop.code}</span>
                            <span class="block text-lg font-semibold text-gray-800 leading-tight">${pop.title}</span>
                        </div>
                    </div>
                    <div class="text-gray-300">${ICONS.chevronRight}</div>
                `;
                listContainer.appendChild(btn);
            });

            container.appendChild(listContainer);
            root.appendChild(container);
        }

        function renderMobileDetail() {
            const pop = POP_DATA.find(p => p.id === state.selectedPopId);
            if (!pop) return;

            const container = document.createElement('div');
            container.className = 'h-full bg-white flex flex-col w-full';

            const topBar = document.createElement('div');
            topBar.className = 'bg-white border-b border-gray-200 p-4 flex items-center justify-between z-20 shadow-sm flex-shrink-0';
            
            const backBtn = document.createElement('button');
            backBtn.className = 'p-2 hover:bg-gray-100 rounded-full transition-colors';
            backBtn.innerHTML = `<span class="text-gray-600">${ICONS.arrowLeft}</span>`;
            backBtn.onclick = goBack;

            const title = document.createElement('span');
            title.className = 'font-bold text-gray-800 truncate px-2';
            title.innerText = pop.code;

            const actions = document.createElement('div');
            actions.className = 'flex space-x-2';
            
            const downloadDocBtn = document.createElement('button');
            downloadDocBtn.className = 'p-2 text-blue-600 hover:bg-blue-50 rounded-full';
            downloadDocBtn.innerHTML = ICONS.download;
            downloadDocBtn.title = 'Baixar como DOC';
            downloadDocBtn.onclick = () => downloadDoc(pop);

            const downloadPdfBtn = document.createElement('button');
            downloadPdfBtn.className = 'p-2 text-red-600 hover:bg-red-50 rounded-full';
            downloadPdfBtn.innerHTML = ICONS.pdf;
            downloadPdfBtn.title = 'Baixar como PDF';
            downloadPdfBtn.onclick = () => downloadPDF(pop);

            actions.appendChild(downloadDocBtn);
            actions.appendChild(downloadPdfBtn);
            
            topBar.appendChild(backBtn);
            topBar.appendChild(title);
            topBar.appendChild(actions);
            container.appendChild(topBar);

            const content = document.createElement('div');
            content.className = 'p-6 overflow-y-auto flex-1';
            content.innerHTML = `
                <div class="prose prose-sm max-w-none prose-headings:text-blue-900 prose-h3:text-base prose-h3:bg-blue-50 prose-h3:p-2 prose-h3:rounded-lg prose-ul:pl-4">
                    ${pop.content}
                </div>
            `;
            container.appendChild(content);

            root.appendChild(container);
        }

        function renderDesktop() {
            const container = document.createElement('div');
            container.className = 'flex h-screen bg-gray-100 overflow-hidden w-full';

            const sidebar = document.createElement('div');
            sidebar.className = 'w-80 bg-white border-r border-gray-200 flex flex-col shadow-xl z-20 flex-shrink-0';
            
            const sidebarHeader = document.createElement('div');
            sidebarHeader.className = 'p-8 bg-blue-900 text-white';
            sidebarHeader.innerHTML = `
                <h2 class="font-bold text-2xl">Gerenciador POPs</h2>
                <p class="text-blue-200 text-sm mt-1">Citometria de Fluxo</p>
            `;
            sidebar.appendChild(sidebarHeader);

            const nav = document.createElement('nav');
            nav.className = 'flex-1 overflow-y-auto p-4 space-y-2';

            POP_DATA.forEach(pop => {
                const isActive = pop.id === state.selectedPopId;
                const btn = document.createElement('button');
                btn.className = `w-full text-left p-4 rounded-xl transition-all duration-200 group relative flex items-center gap-3 ${
                    isActive ? 'bg-blue-50 border-blue-200 shadow-sm ring-1 ring-blue-200' : 'hover:bg-gray-50 border border-transparent'
                }`;
                btn.onclick = () => selectPop(pop.id);
                btn.innerHTML = `
                    <div class="p-2 rounded-lg ${isActive ? 'bg-white text-blue-600 shadow-sm' : 'bg-gray-100 text-gray-400'}">
                        ${pop.icon}
                    </div>
                    <div>
                        <span class="block text-xs font-bold uppercase tracking-wider ${isActive ? 'text-blue-600' : 'text-gray-400'}">${pop.code}</span>
                        <span class="block text-sm font-medium ${isActive ? 'text-gray-900' : 'text-gray-600'}">${pop.title}</span>
                    </div>
                `;
                nav.appendChild(btn);
            });
            sidebar.appendChild(nav);
            container.appendChild(sidebar);

            const main = document.createElement('div');
            main.className = 'flex-1 flex flex-col h-full relative bg-gray-50 min-w-0';

            const pop = POP_DATA.find(p => p.id === state.selectedPopId);

            if (pop) {
                const topHeader = document.createElement('header');
                topHeader.className = 'bg-white border-b border-gray-200 px-8 py-4 flex items-center justify-between shadow-sm print:hidden flex-shrink-0';
                
                const breadcrumb = document.createElement('div');
                breadcrumb.className = 'flex items-center text-sm text-gray-500';
                breadcrumb.innerHTML = `
                    <span>Biblioteca</span>
                    <span class="mx-2 text-gray-300">${ICONS.chevronRight}</span>
                    <span class="font-semibold text-blue-900 bg-blue-50 px-2 py-0.5 rounded text-xs uppercase tracking-wide">${pop.code}</span>
                `;

                const actions = document.createElement('div');
                actions.className = 'flex space-x-3';
                
                const btnPrint = document.createElement('button');
                btnPrint.className = 'flex items-center px-4 py-2 text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors shadow-sm text-sm font-medium';
                btnPrint.innerHTML = `<span class="mr-2">${ICONS.printer}</span> Imprimir`;
                btnPrint.onclick = () => window.print();

                const btnDownloadDoc = document.createElement('button');
                btnDownloadDoc.className = 'flex items-center px-4 py-2 text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg text-sm font-medium';
                btnDownloadDoc.innerHTML = `<span class="mr-2">${ICONS.download}</span> Baixar .doc`;
                btnDownloadDoc.onclick = () => downloadDoc(pop);

                const btnDownloadPdf = document.createElement('button');
                btnDownloadPdf.className = 'flex items-center px-4 py-2 text-white bg-red-600 border border-transparent rounded-lg hover:bg-red-700 transition-all shadow-md hover:shadow-lg text-sm font-medium';
                btnDownloadPdf.innerHTML = `<span class="mr-2">${ICONS.pdf}</span> Baixar .pdf`;
                btnDownloadPdf.onclick = () => downloadPDF(pop);

                actions.appendChild(btnPrint);
                actions.appendChild(btnDownloadDoc);
                actions.appendChild(btnDownloadPdf);
                
                topHeader.appendChild(breadcrumb);
                topHeader.appendChild(actions);
                main.appendChild(topHeader);

                const scrollArea = document.createElement('div');
                scrollArea.className = 'flex-1 overflow-y-auto p-8 print:p-0 print:bg-white';
                
                const paper = document.createElement('div');
                paper.className = 'a4-paper print:shadow-none print:m-0 print:w-full';
                paper.id = 'document-content';

                const docHeader = `
                    <div class="border-b-2 border-gray-800 pb-4 mb-8 flex justify-between items-end">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 leading-none mb-2">${pop.code}</h1>
                            <p class="text-gray-500 text-sm uppercase tracking-widest font-semibold">Procedimento Operacional Padrão</p>
                        </div>
                        <div class="text-right text-xs text-gray-400">
                            <p>Laboratório de Citometria</p>
                            <p>${new Date().toLocaleDateString()}</p>
                        </div>
                    </div>
                `;

                const docBody = `
                    <div class="prose prose-slate max-w-none 
                        prose-headings:text-blue-900 
                        prose-h1:text-2xl 
                        prose-h3:text-lg prose-h3:uppercase prose-h3:tracking-wide prose-h3:text-blue-800 prose-h3:border-b prose-h3:border-blue-100 prose-h3:pb-2 prose-h3:mt-8
                        prose-h4:text-base prose-h4:font-bold prose-h4:mt-6 prose-h4:text-gray-800
                        prose-p:text-justify prose-p:leading-relaxed
                        prose-li:marker:text-blue-500">
                        ${pop.content}
                    </div>
                `;

                const docFooter = `
                    <div class="mt-24 pt-8 border-t border-gray-200 grid grid-cols-2 gap-16 print:break-inside-avoid">
                        <div>
                            <div class="h-px w-full bg-gray-400 mb-2"></div>
                            <p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Elaborado por</p>
                        </div>
                        <div>
                            <div class="h-px w-full bg-gray-400 mb-2"></div>
                            <p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Aprovado por (Responsável Técnico)</p>
                        </div>
                    </div>
                `;

                paper.innerHTML = docHeader + docBody + docFooter;
                scrollArea.appendChild(paper);
                
                const spacer = document.createElement('div');
                spacer.className = 'h-12';
                scrollArea.appendChild(spacer);

                main.appendChild(scrollArea);
            }

            container.appendChild(main);
            root.appendChild(container);
        }

        // --- FUNÇÃO DOWNLOAD DOC ---
        function downloadDoc(pop) {
            // Clonar conteúdo e substituir checkboxes
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pop.content;

            const checkboxes = tempDiv.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                const span = document.createElement('span');
                // Caractere Unicode para caixa vazia
                span.textContent = '☐'; 
                span.style.fontSize = '14pt';
                cb.parentNode.replaceChild(span, cb);
            });

            // CSS INLINE PARA FORMATAR O ARQUIVO WORD
            const cssStyles = `
                body { font-family: 'Calibri', 'Arial', sans-serif; font-size: 11pt; color: #000000; line-height: 1.5; }
                h1 { font-size: 18pt; color: #1e3a8a; border-bottom: 2px solid #1e3a8a; padding-bottom: 6px; margin-top: 0; margin-bottom: 20px; }
                h3 { font-size: 13pt; color: #1e3a8a; background-color: #f0f9ff; padding: 5px; margin-top: 24px; margin-bottom: 12px; border-left: 5px solid #1e3a8a; font-weight: bold; }
                h4 { font-size: 12pt; color: #333; margin-top: 18px; margin-bottom: 8px; font-weight: bold; text-decoration: underline; }
                p { margin-bottom: 10pt; text-align: justify; }
                ul, ol { margin-bottom: 12pt; }
                li { margin-bottom: 4pt; }
                table { width: 100%; border-collapse: collapse; margin-top: 12px; margin-bottom: 12px; }
                th, td { border: 1px solid #000; padding: 8px; font-size: 10pt; vertical-align: top; }
                th { background-color: #e5e7eb; font-weight: bold; text-align: left; }
                strong { font-weight: bold; }
                .page-break { page-break-before: always; }
                hr { border: 0; border-top: 1px solid #ccc; margin: 20px 0; }
            `;

            const header = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' 
                      xmlns:w='urn:schemas-microsoft-com:office:word' 
                      xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset='utf-8'>
                    <title>${pop.title}</title>
                    <style>${cssStyles}</style>
                </head>
                <body>
            `;
            
            const docHeader = `
                <table style="border: none; width: 100%; margin-bottom: 20px;">
                    <tr>
                        <td style="border: none;">
                            <h1 style="border:none; margin:0; font-size: 24pt;">${pop.code}</h1>
                            <p style="margin:0; color: #666; text-transform: uppercase; font-size: 10pt; font-weight: bold;">Procedimento Operacional Padrão</p>
                        </td>
                        <td style="border: none; text-align: right; color: #666; font-size: 9pt;">
                            <p style="margin:0;">Laboratório de Citometria</p>
                            <p style="margin:0;">${new Date().toLocaleDateString()}</p>
                        </td>
                    </tr>
                    <tr><td colspan="2" style="border-bottom: 2px solid #000; height: 5px;"></td></tr>
                </table>
            `;

            const docFooter = `
                <br><br><br>
                <table style="border: none; width: 100%; margin-top: 40px;">
                    <tr>
                        <td style="border: none; width: 45%;">
                            <div style="border-top: 1px solid #000; padding-top: 5px; font-size: 9pt; font-weight: bold;">Elaborado por</div>
                        </td>
                        <td style="border: none; width: 10%;"></td>
                        <td style="border: none; width: 45%;">
                            <div style="border-top: 1px solid #000; padding-top: 5px; font-size: 9pt; font-weight: bold;">Aprovado por (Responsável Técnico)</div>
                        </td>
                    </tr>
                </table>
            `;

            const sourceHTML = header + docHeader + tempDiv.innerHTML + docFooter + "</body></html>";
            
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = `${pop.code} - ${pop.title}.doc`;
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }

        // --- FUNÇÃO DOWNLOAD PDF ---
        function downloadPDF(pop) {
            // Criar elemento temporário para o PDF
            const pdfContainer = document.createElement('div');
            pdfContainer.className = 'pdf-content';
            pdfContainer.style.cssText = 'position: absolute; left: -9999px; top: 0; width: 210mm; padding: 20mm; background: white;';
            
            // Substituir checkboxes por caracteres Unicode
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pop.content;
            
            const checkboxes = tempDiv.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                const span = document.createElement('span');
                span.textContent = '☐';
                span.className = 'pdf-checkbox';
                cb.parentNode.replaceChild(span, cb);
            });
            
            // Construir conteúdo do PDF
            const pdfContent = `
                <div class="pdf-header">
                    <h1 style="font-size: 24pt; margin: 0 0 5px 0;">${pop.code}</h1>
                    <p style="font-size: 12pt; color: #666; margin: 0 0 15px 0; text-transform: uppercase; font-weight: bold;">Procedimento Operacional Padrão</p>
                    <div style="display: flex; justify-content: space-between; font-size: 9pt; color: #666;">
                        <div>
                            <p style="margin: 0;">Laboratório de Citometria</p>
                            <p style="margin: 0;">${pop.title}</p>
                        </div>
                        <div style="text-align: right;">
                            <p style="margin: 0;">Data: ${new Date().toLocaleDateString()}</p>
                            <p style="margin: 0;">Versão: 1.0</p>
                        </div>
                    </div>
                </div>
                
                ${tempDiv.innerHTML}
                
                <div class="pdf-footer">
                    <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                        <div style="width: 45%;">
                            <div style="border-top: 1px solid #000; padding-top: 5px; margin-top: 20px;">
                                <p style="font-size: 9pt; font-weight: bold; margin: 0;">Elaborado por:</p>
                                <p style="font-size: 9pt; margin: 5px 0 0 0;">_________________________________</p>
                                <p style="font-size: 8pt; margin: 2px 0 0 0;">Nome, Assinatura e Data</p>
                            </div>
                        </div>
                        <div style="width: 10%;"></div>
                        <div style="width: 45%;">
                            <div style="border-top: 1px solid #000; padding-top: 5px; margin-top: 20px;">
                                <p style="font-size: 9pt; font-weight: bold; margin: 0;">Aprovado por (Responsável Técnico):</p>
                                <p style="font-size: 9pt; margin: 5px 0 0 0;">_________________________________</p>
                                <p style="font-size: 8pt; margin: 2px 0 0 0;">Nome, Assinatura e Data</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pdfContainer.innerHTML = pdfContent;
            document.body.appendChild(pdfContainer);
            
            // Configurações do PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `${pop.code} - ${pop.title}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    letterRendering: true,
                    width: pdfContainer.offsetWidth
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                }
            };
            
            // Gerar PDF
            html2pdf().set(opt).from(pdfContainer).save().then(() => {
                // Remover elemento temporário
                document.body.removeChild(pdfContainer);
            });
        }

        init();

    </script>
</body>
</html>
